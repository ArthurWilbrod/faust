#!/bin/bash -e

#####################################################################
#                                                                   #
#                    faust2daisy generator                          #
#                       (c) Grame, 2020                             #
#                                                                   #
#####################################################################

. faustpath
. faustoptflags
. usage.sh

ARCHFILE=$FAUSTARCH/daisy/faust.cpp

# exit if a command fails
set -e

# global option variables
NVOICES=0
MULTI="0"
POLY=""
PATCH="0"

echoHelp ()
{
    echo "faust2daisy [-patch] [-midi] [-nvoices <num>] [additional Faust options (-vec -vs 8...)] <file.dsp> 
    option
    echo "Use '-patch' to compile for 4 ins/outs Patch"
    options -midi
    option "-nvoices <num>"
    echo ""
}

###########################
# Processing Arguments
###########################

while [ $1 ]
do
    p=$1
    # help
    if [ $p = "-help" ] || [ $p = "-h" ]; then
	echoHelp
	exit 0
    # -nvoices:
    elif [ $p = "-nvoices" ]; then
    	shift
    	NVOICES=$1
    # -midi
    elif [ $p = "-midi" ]; then
        MIDIDEFS="MIDI"
    elif [ $p = "-patch" ]; then
        PATCH="1"
    elif [[ -f "$p" ]]; then
    	FILE="$p"
    # other compile options
    else
        OPTIONS="$OPTIONS $p"
    fi

shift

done

if [ -z $FILE ]; then
    echo "Please, provide a Faust file to process"
    exit 1
fi

# TODO
